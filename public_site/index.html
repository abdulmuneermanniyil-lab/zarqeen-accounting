<!-- ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸëŸéŸáŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê  -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zarqeen Alif - Smart Billing</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --primary: #2563EB; --primary-dark: #1E40AF; --bg: #F8FAFC; --text: #1E293B; --white: #fff; --success: #10B981; --danger: #EF4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); line-height: 1.5; }
        
        /* Fixed Header */
        header { background: var(--white); border-bottom: 1px solid #E5E7EB; position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1100px; margin: 0 auto; padding: 0.8rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { display: flex; align-items: center; gap: 10px; }
        .nav-links a { color: #4B5563; font-weight: 600; font-size: 0.9rem; margin-right: 1.5rem; cursor: pointer; text-decoration: none; }
        .nav-btn { background: var(--primary); color: white !important; padding: 0.5rem 1.2rem; border-radius: 8px; font-weight: 700; }

        /* Fixed Hero Layout */
        .hero { text-align: center; padding: 6rem 1.5rem; background: #fff; border-bottom: 1px solid #E5E7EB; }
        .hero h1 { font-size: 2.8rem; font-weight: 800; margin-bottom: 1.5rem; line-height: 1.2; }
        .hero p { max-width: 600px; margin: 0 auto 2.5rem; color: #64748B; font-size: 1.1rem; }
        .hero-btns { display: flex; justify-content: center; gap: 15px; }

        /* Dashboard Styles */
        #dashboardSection { display: none; max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .dash-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #E2E8F0; margin-bottom: 20px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-box { background: #f1f5f9; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-box small { text-transform: uppercase; font-size: 0.7rem; font-weight: bold; color: #64748B; }
        .stat-box p { font-size: 1.4rem; font-weight: 800; color: var(--primary-dark); }
        
        .bank-details { background: #fffbeb; border: 1px solid #fef3c7; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        
        .dash-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        .dash-table th, .dash-table td { padding: 12px; text-align: left; font-size: 0.85rem; border-bottom: 1px solid #eee; }
        
        .pagination { display: flex; justify-content: center; gap: 10px; align-items: center; }
        
        footer { background: white; padding: 40px 20px; border-top: 1px solid #E5E7EB; text-align: center; margin-top: 60px; }
        
        /* Modals */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .modal-content { background: white; margin: 8vh auto; border-radius: 12px; width: 90%; max-width: 400px; overflow: hidden; position: relative; }
        .tab-btn.active { border-bottom: 3px solid var(--primary); color: var(--primary); }
    </style>
</head>
<body>
    <div id="actionLoader" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:99999; flex-direction:column; align-items:center; justify-content:center;">
        <div class="spinner"></div><p style="margin-top:10px;">Loading...</p>
    </div>

    <header id="mainHeader">
        <div class="nav-container">
            <div class="logo-area">
                <img src="static/logo.png" style="height:40px;" alt="Logo">
                <span style="font-weight:800; font-size:1.2rem; color:var(--primary-dark)">Zarqeen Alif</span>
            </div>
            <nav class="nav-links">
                <a onclick="openModal('loginModal')">Partner Login</a>
                <a id="navDownBtn" class="nav-btn" onclick="checkDownload(event)">Download</a>
            </nav>
        </div>
    </header>

    <main id="mainPage">
        <section class="hero">
            <h1>India's Most Trusted <span>Offline Billing</span></h1>
            <p>High-speed invoicing, inventory, and reports for retail businesses. 100% Private.</p>
            <div class="hero-btns">
                <a id="heroDownBtn" onclick="checkDownload(event)" class="nav-btn" style="padding:15px 40px; font-size:1.1rem; text-decoration:none;">Download Free Trial</a>
            </div>
            <p id="vText" style="margin-top:20px; font-size:0.8rem; color:gray">v1.2.0</p>
        </section>

        <!-- Features -->
        <section style="max-width:1100px; margin: 40px auto; display:grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap:20px; padding:0 20px;">
            <div class="dash-card"><h3>‚ö° Ultra Fast</h3><p>Generate bills in <5 seconds without internet.</p></div>
            <div class="dash-card"><h3>üñ®Ô∏è Multi-Printer</h3><p>Supports A4, A5, and all thermal printers.</p></div>
            <div class="dash-card"><h3>üìä Analytics</h3><p>Track top items and quarterly GST liability.</p></div>
        </section>
    </main>

    <!-- PARTNER DASHBOARD (No Zarqeen Header) -->
    <div id="dashboardSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #ddd; padding-bottom:15px;">
            <div>
                <h2 id="pName">Partner</h2>
                <span id="pCodeTier" style="font-size:0.8rem; color:gray"></span>
            </div>
            <button onclick="logout()" class="nav-btn" style="background:var(--danger); border:none;">Exit Dashboard</button>
        </div>

        <div class="info-grid">
            <div class="stat-box"><small>Comm. Rate</small><p id="d_rate">0%</p></div>
            <div class="stat-box"><small>Total Earned</small><p id="d_earned">‚Çπ0</p></div>
            <div class="stat-box"><small>Already Paid</small><p id="d_paid" style="color:var(--success)">‚Çπ0</p></div>
            <div class="stat-box"><small>Balance</small><p id="d_balance" style="color:var(--danger)">‚Çπ0</p></div>
        </div>

        <div class="bank-details">
            <div>
                <h4 style="margin-bottom:5px;">Settlement Details</h4>
                <p id="bankSummary" style="font-size:0.85rem; color:#444;">No bank details provided.</p>
            </div>
            <button onclick="openModal('bankModal')" class="nav-btn" style="background:#000; font-size:0.75rem;">Edit Bank Info</button>
        </div>

        <table class="dash-table">
            <thead><tr><th>Date</th><th>Plan</th><th>Earnings</th><th>Status</th><th>Key</th></tr></thead>
            <tbody id="hBody"></tbody>
        </table>
        
        <div class="pagination">
            <button id="prevBtn" onclick="changePage(-1)" class="nav-btn" style="background:gray;">Prev</button>
            <span id="pageText">Page 1</span>
            <button id="nextBtn" onclick="changePage(1)" class="nav-btn">Next</button>
        </div>
    </div>

    <footer>
        <p style="font-weight:700;">Zarqeen Accounting Solutions</p>
        <p style="font-size:0.8rem; color:gray; margin-top:5px;">&copy; 2025 India. Support: zarqeen.in</p>
    </footer>

    <!-- Bank Modal -->
    <div id="bankModal" class="modal">
        <div class="modal-content" style="padding:25px;">
            <h3>Update Bank Info</h3>
            <form id="bankForm" style="margin-top:15px;">
                <input type="text" name="bank_name" placeholder="Bank Name" required style="width:100%; padding:10px; margin-bottom:10px;">
                <input type="text" name="account_holder" placeholder="Account Holder" required style="width:100%; padding:10px; margin-bottom:10px;">
                <input type="text" name="account_number" placeholder="Account Number" required style="width:100%; padding:10px; margin-bottom:10px;">
                <input type="text" name="ifsc_code" placeholder="IFSC Code" required style="width:100%; padding:10px; margin-bottom:10px;">
                <input type="text" name="upi_id" placeholder="UPI ID (e.g. name@okicici)" required style="width:100%; padding:10px; margin-bottom:15px;">
                <button type="submit" class="nav-btn" style="width:100%; border:none;">Save Details</button>
                <p style="text-align:center; margin-top:10px;"><a onclick="closeModal('bankModal')" style="cursor:pointer; font-size:0.8rem;">Cancel</a></p>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="tab-header" style="display:flex;">
                <button id="btnP" class="tab-btn active" style="flex:1; padding:15px; border:none; cursor:pointer;" onclick="switchTab('p')">Partner</button>
                <button id="btnA" class="tab-btn" style="flex:1; padding:15px; border:none; cursor:pointer;" onclick="switchTab('a')">Admin</button>
            </div>
            <div id="pTab" style="padding:20px;">
                <form id="pForm">
                    <input type="email" name="email" placeholder="Email" required style="width:100%; padding:10px; margin-bottom:10px;">
                    <input type="password" name="password" placeholder="Password" required style="width:100%; padding:10px; margin-bottom:15px;">
                    <button type="submit" class="nav-btn" style="width:100%; border:none;">Login as Partner</button>
                </form>
            </div>
            <div id="aTab" style="padding:20px; display:none;">
                <form id="aForm">
                    <input type="text" name="username" placeholder="Admin User" required style="width:100%; padding:10px; margin-bottom:10px;">
                    <input type="password" name="password" placeholder="Password" required style="width:100%; padding:10px; margin-bottom:15px;">
                    <button type="submit" class="nav-btn" style="width:100%; border:none; background:#000;">Admin Login</button>
                </form>
            </div>
            <p style="text-align:center; padding-bottom:15px;"><a onclick="closeModal('loginModal')" style="cursor:pointer; font-size:0.8rem; color:gray;">Cancel</a></p>
        </div>
    </div>

    <script>
        const _0x1a = "aHR0cHM6Ly96YXJxZWVuLWJhY2tlbmQub25yZW5kZXIuY29t";
        const BASE_URL = atob(_0x1a);
        let CUR_PAGE = 1;

        async function initApp() {
            try {
                const res = await fetch(`${BASE_URL}/api/v1/config`);
                const data = await res.json();
                document.querySelectorAll('#navDownBtn, #heroDownBtn').forEach(a => a.href = data.DOWNLOAD_LINK);
                if(localStorage.getItem('dist_token')) loadDashboard(1);
            } catch(e) {}
        }

        async function loadDashboard(page) {
            CUR_PAGE = page;
            const res = await fetch(`${BASE_URL}/api/distributor/data?page=${page}`, {
                headers: {'Authorization': `Bearer ${localStorage.getItem('dist_token')}`}
            });
            if(res.status === 401) { logout(); return; }
            const d = await res.json();

            document.getElementById('pName').innerText = d.name;
            document.getElementById('pCodeTier').innerText = `Code: ${d.code} | Level: ${d.tier}`;
            document.getElementById('d_rate').innerText = `${d.comm_pct}%`;
            document.getElementById('d_earned').innerText = `‚Çπ${d.financials.earned}`;
            document.getElementById('d_paid').innerText = `‚Çπ${d.financials.paid}`;
            document.getElementById('d_balance').innerText = `‚Çπ${d.financials.balance}`;
            document.getElementById('bankSummary').innerText = d.bank.acc ? `${d.bank.name} (${d.bank.acc}) - UPI: ${d.bank.upi}` : "Please update bank details.";
            
            let h = ""; d.history.forEach(l => {
                h += `<tr><td>${l.date}</td><td>${l.plan}</td><td>‚Çπ${l.commission}</td><td><b style="color:${l.status=='USED'?'green':'#f59e0b'}">${l.status}</b></td><td style="font-family:monospace">${l.key}</td></tr>`;
            });
            document.getElementById('hBody').innerHTML = h;
            document.getElementById('pageText').innerText = `Page ${d.pagination.current_page} of ${d.pagination.total_pages}`;
            
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
        }

        document.getElementById('bankForm').onsubmit = async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            const res = await fetch(`${BASE_URL}/api/distributor/update-bank`, {
                method: 'POST', headers: {'Content-Type':'application/json', 'Authorization': `Bearer ${localStorage.getItem('dist_token')}`},
                body: JSON.stringify(data)
            });
            if(res.ok) { Swal.fire('Saved','Details updated','success'); loadDashboard(CUR_PAGE); closeModal('bankModal'); }
        };

        function switchTab(t) {
            document.getElementById('pTab').style.display = t=='p'?'block':'none';
            document.getElementById('aTab').style.display = t=='a'?'block':'none';
            document.getElementById('btnP').classList.toggle('active', t=='p');
            document.getElementById('btnA').classList.toggle('active', t=='a');
        }
        function changePage(dir) { loadDashboard(CUR_PAGE + dir); }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        function openModal(id) { document.getElementById(id).style.display='block'; }
        function logout() { localStorage.removeItem('dist_token'); location.reload(); }
        window.onload = initApp;
    </script>
</body>
</html>
