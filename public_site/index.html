<!-- ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸëŸéŸáŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê  -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zarqeen Alif - India's Best Value Invoicing Software</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/png" href="static/header.png">
    
    <style>
        :root { --primary: #2563EB; --primary-dark: #1E40AF; --accent: #F59E0B; --bg-light: #F3F4F6; --text-main: #111827; --text-muted: #6B7280; --white: #ffffff; --success: #10B981; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        body { background-color: var(--bg-light); color: var(--text-main); line-height: 1.6; }
        a { text-decoration: none; } ul { list-style: none; }
        
        /* LOADER */
        #actionLoader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 999999; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #E5E7EB; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        header { background: var(--white); box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .brand-name { font-weight: 800; font-size: 1.35rem; color: var(--primary-dark); }
        .nav-links { display: flex; align-items: center; gap: 2rem; }
        .nav-links a { color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; }
        .nav-btn { background: var(--primary); color: var(--white) !important; padding: 0.6rem 1.2rem; border-radius: 8px; font-weight: 600; }
        
        .mobile-menu-btn { display: none; background: none; border: none; font-size: 1.8rem; cursor: pointer; }
        .mobile-nav { display: none; position: absolute; top: 100%; left: 0; width: 100%; background: white; padding: 1rem; flex-direction: column; gap: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 999; }
        .mobile-nav.active { display: flex; }

        .hero { text-align: center; padding: 5rem 1rem; background: linear-gradient(180deg, #FFFFFF 0%, #EFF6FF 100%); border-bottom: 1px solid #DBEAFE; }
        .hero h1 { font-size: 3rem; font-weight: 800; margin-bottom: 1.5rem; }
        .hero h1 span { color: var(--primary); }
        .hero p { font-size: 1.2rem; color: var(--text-muted); max-width: 700px; margin: 0 auto 2.5rem; }
        
        .btn-lg { padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: transform 0.2s; }
        .btn-primary { background: var(--primary); color: var(--white); }
        
        .features { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; }
        .feature-card { background: var(--white); padding: 2rem; border-radius: 12px; border: 1px solid #E5E7EB; text-align: center; transition: 0.3s; }
        .feature-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        
        .pricing-section { padding: 4rem 1rem; text-align: center; }
        .section-title { font-size: 2.25rem; font-weight: 800; margin-bottom: 0.5rem; }
        .section-subtitle { color: var(--text-muted); margin-bottom: 3rem; }
        .pricing-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .plan-card { background: var(--white); padding: 2.5rem; border-radius: 16px; border: 1px solid #E5E7EB; display: flex; flex-direction: column; }
        .plan-card.popular { border: 2px solid var(--primary); transform: scale(1.05); }
        .price { font-size: 3rem; font-weight: 800; margin: 1rem 0; }

        .btn-buy { width: 100%; padding: 1rem; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; margin-top: auto; }
        .btn-buy.primary { background: var(--primary); color: var(--white); }
        .btn-buy.secondary { background: #E5E7EB; color: #374151; }

        /* DASHBOARD */
        #dashboardSection { display: none; padding: 2rem; max-width: 1200px; margin: 0 auto; }
        .dash-header { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .dash-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .dash-val { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .dash-table { width: 100%; background: white; border-collapse: collapse; border-radius: 12px; overflow: hidden; }
        .dash-table th, .dash-table td { padding: 15px; text-align: left; border-bottom: 1px solid #E5E7EB; }

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); overflow-y: auto; padding: 20px; }
        .modal-content { background: white; margin: 5vh auto; padding: 2rem; border-radius: 12px; width: 100%; max-width: 450px; position: relative; }
        .close-icon { position: absolute; right: 20px; top: 20px; font-size: 24px; cursor: pointer; }

        .tab-btn { flex: 1; padding: 10px; border: none; background: none; font-weight: 600; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: var(--primary) !important; border-bottom: 2px solid var(--primary) !important; opacity: 1 !important; }
        .login-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #EEE; }
        .login-form { display: none; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.9rem; margin-bottom: 5px; font-weight: 600; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; }
        /* Pricing Section Enhancements */
.pricing-grid {
    gap: 1.5rem;
    padding-top: 1rem;
}

.plan-card {
    border: 1px solid #E5E7EB;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    background: var(--white);
    position: relative;
    overflow: hidden;
}

.plan-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    border-color: var(--primary);
}

.plan-card.popular {
    border: 2px solid var(--primary);
    background: linear-gradient(180deg, #FFFFFF 0%, #F0F7FF 100%);
}

.plan-card h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-main);
}

.price {
    font-size: 3.5rem !important;
    color: var(--primary-dark);
    letter-spacing: -2px;
}

.price span {
    font-size: 1rem;
    color: var(--text-muted);
    letter-spacing: 0;
}

.plan-features {
    text-align: left;
    margin: 1.5rem 0;
    padding: 1.5rem 0;
    border-top: 1px solid #F3F4F6;
    font-size: 0.9rem;
}

.plan-features li {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: #4B5563;
}

.plan-features li::before {
    content: "‚úì";
    color: var(--success);
    font-weight: 800;
}

/* Footer Styling */
footer {
    background: #111827 !important;
    color: #9CA3AF !important;
}

footer a {
    color: #60A5FA !important;
    transition: 0.2s;
}

footer a:hover {
    color: #FFFFFF !important;
}
        @media (max-width: 768px) { .nav-links { display: none; } .mobile-menu-btn { display: block; } .hero h1 { font-size: 2.2rem; } .plan-card.popular { transform: none; } }
    </style>
</head>
<body>

    <div id="actionLoader">
        <div class="spinner"></div>
        <div id="loaderText" style="font-weight:600;">Loading...</div>
    </div>

    <header>
        <div class="nav-container">
            <div class="logo-area">
                <img src="static/logo.png" style="height:40px;">
                <span class="brand-name">Zarqeen Alif</span>
            </div>
            <nav class="nav-links">
                <a onclick="openRegisterModal()">Join as Distributor</a>
                <a onclick="openLoginModal()">Login</a>
                <a href="#" class="nav-btn dynamic-dl" onclick="checkDownload(event)">Download</a>
            </nav>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
        </div>
        <div class="mobile-nav" id="mobileNav">
            <a onclick="toggleMobileMenu(); openRegisterModal()">Join as Distributor</a>
            <a onclick="toggleMobileMenu(); openLoginModal()">Login</a>
            <a href="#" class="dynamic-dl" onclick="checkDownload(event)">Download Software</a>
        </div>
    </header>

    <section class="hero">
        <div style="background:#DBEAFE; color:#1E40AF; padding:6px 16px; border-radius:50px; display:inline-block; font-size:0.8rem; font-weight:700; margin-bottom:1rem;">üáÆüá≥ MADE FOR INDIA</div>
        <h1>India's Best Value <br><span>Invoicing Software</span></h1>
        <p>The easiest offline billing software for Retail Indian Businesses who want simplicity, speed, and zero recurring fees.</p>
        <div class="cta-group">
            <a href="#" class="dynamic-dl" onclick="checkDownload(event)">
                <button class="btn-lg btn-primary">Download Free Trial</button>
            </a>
        </div>
        <div style="font-size:0.85rem; color:gray; margin-top:1.5rem;">v1.1.0 ‚Ä¢ A4, A5 & Thermal Support ‚Ä¢ 52MB ‚Ä¢ 100% Offline</div>
    </section>

    <section id="features" class="features" style="margin-top:-3rem; position:relative; z-index:10;">
        <div class="feature-card"><h3>‚ö° Fast & Offline</h3><p>Generates bills in seconds without internet. Your data stays safe on your PC.</p></div>
        <div class="feature-card"><h3>üñ®Ô∏è All Paper Sizes</h3><p>Print on A4, A5, or 2"/3" Thermal Printers with professional layouts.</p></div>
        <div class="feature-card"><h3>üáÆüá≥ Indian GST Ready</h3><p>Pre-loaded with State codes and currency formats specific to the Indian market.</p></div>
    </section>

    <section id="target-businesses" class="pricing-section" style="background: #fff; padding-top: 2rem;">
        <h2 class="section-title">Perfect for Your Business</h2>
        <p class="section-subtitle">Tailored billing for every retail sector</p>
        <div class="features" style="margin-top: 0;">
            <div class="feature-card"><div>üëï</div><h3>Textile & Garments</h3><p>Quick A4/A5 billing for boutiques and clothing stores.</p></div>
            <div class="feature-card"><div>üõí</div><h3>Grocery & Kirana</h3><p>Lightning checkout for thermal printers.</p></div>
            <div class="feature-card"><div>üì±</div><h3>Electronics</h3><p>Professional GST invoices for mobile shops.</p></div>
            <div class="feature-card"><div>üîß</div><h3>Hardware</h3><p>Manage thousands of items with zero lag.</p></div>
            <div class="feature-card"><div>üëü</div><h3>Footwear</h3><p>Ideal for shoe stores and bag shops.</p></div>
            <div class="feature-card"><div>üé®</div><h3>Paints & Decor</h3><p>Easy unit management for home decor.</p></div>
            <div class="feature-card"><div>üç∞</div><h3>Bakeries</h3><p>Fast thermal bills for sweet stalls and cafes.</p></div>
            <div class="feature-card"><div>üìö</div><h3>Stationery</h3><p>Efficient billing for school and gift items.</p></div>
        </div>
    </section>

    <section id="pricing" class="pricing-section">
    <h2 class="section-title">Unbeatable Pricing</h2>
    <p class="section-subtitle">Choose the plan that fits your business growth</p>
    
    <div style="max-width:400px; margin: 0 auto 3rem;">
        <p style="font-weight:600; margin-bottom:10px;">Have a Distributor Code?</p>
        <div style="display:flex; gap:8px;">
            <input type="text" id="distCode" placeholder="Enter Code (e.g. ALIF)" style="flex:1; padding:12px; border-radius:8px; border:1px solid #DDD; text-transform:uppercase; font-weight:700;">
            <button onclick="applyCode()" class="nav-btn" style="border:none; cursor:pointer;">Apply</button>
        </div>
        <p id="codeMsg" style="font-size:0.85rem; margin-top:8px; font-weight:600;"></p>
    </div>

    <div class="pricing-grid">
        <!-- Trial Plan -->
        <div class="plan-card">
            <h3>Trial</h3>
            <div class="price">Free</div>
            <ul class="plan-features">
                <li>7 Days Full Access</li>
                <li>All Paper Sizes</li>
                <li>Indian GST Format</li>
                <li>Offline Storage</li>
            </ul>
            <a href="#" class="dynamic-dl" onclick="checkDownload(event)" style="margin-top:auto;">
                <button class="btn-buy secondary">Download Now</button>
            </a>
        </div>

        <!-- Basic Plan -->
        <div class="plan-card">
            <h3>Basic</h3>
            <div class="price">‚Çπ299<span>/year</span></div>
            <ul class="plan-features">
                <li>1 Year License</li>
                <li>Unlimited Invoices</li>
                <li>Free Version Updates</li>
                <li>Standard Support</li>
            </ul>
            <button class="btn-buy primary" onclick="buyPlan('basic')">Buy Basic License</button>
        </div>

        <!-- Premium Plan -->
        <div class="plan-card popular">
            <div style="position:absolute; top:12px; right:-30px; background:var(--accent); color:brown; padding:5px 40px; font-size:0.7rem; font-weight:800; transform:rotate(45deg);">BEST VALUE</div>
            <h3>Premium</h3>
            <div class="price">‚Çπ599<span>/3 yrs</span></div>
            <ul class="plan-features">
                <li>3 Year License</li>
                <li>Priority WhatsApp Support</li>
                <li>Business Logo Branding</li>
                <li>Everything in Basic</li>
            </ul>
            <button class="btn-buy primary" onclick="buyPlan('premium')">Buy Premium License</button>
        </div>
    </div>
</section>

   <footer style="text-align:center; padding:4rem 1rem;">
    <div style="margin-bottom: 1.5rem;">
        <img src="static/logo.png" style="height:35px; filter: grayscale(1) brightness(2); margin-bottom: 10px;">
        <p style="font-size: 0.9rem;">The simplest offline billing solution for Indian Retailers.</p>
    </div>
    
    <div style="margin-bottom: 1.5rem; font-size: 0.9rem;">
        <strong>Contact Support:</strong> <a href="mailto:support@zarqeen.in">support@zarqeen.in</a>
    </div>

    <div style="border-top: 1px solid #1F2937; padding-top: 2rem; font-size: 0.8rem;">
        <p>&copy; <span id="year"></span> Zarqeen Accounting Solutions. All rights reserved.</p>
        <div style="margin-top: 10px; display: flex; justify-content: center; gap: 20px;">
            <a onclick="openLoginModal()" style="cursor:pointer;">Partner Portal</a>
            <a href="#fullTermsModal" onclick="document.getElementById('fullTermsModal').style.display='block'; return false;">Terms of Service</a>
        </div>
    </div>
</footer>

    <!-- DISTRIBUTOR DASHBOARD -->
    <div id="dashboardSection">
        <div class="dash-header">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div><h2 id="dashName">Distributor</h2><p style="color:gray;">Code: <strong id="dashCode"></strong></p></div>
                <button onclick="doLogout()" class="btn-buy secondary" style="width:auto; background:#EF4444; color:white; padding:10px 20px;">Logout</button>
            </div>
        </div>
        
        <div class="dash-grid">
            <div class="dash-card">
                <div class="dash-val" id="dashTotal">0</div>
                <div>Total Sales</div>
            </div>
            <div class="dash-card">
                <div id="dashComm">Financials</div>
            </div>
           <div class="dash-card">
    <div style="display:flex; justify-content:space-between; align-items: flex-start;">
        <div id="lvlName" style="font-size:1.5rem; font-weight:700; color:var(--primary);">Bronze</div>
        <div style="text-align:right; display:flex; flex-direction:column; gap:4px;">
            <span id="lvlDisc" style="background:#DBEAFE; color:#1E40AF; padding:2px 8px; border-radius:4px; font-size:0.75rem; font-weight:700;">10% OFF</span>
            <span id="lvlCommRate" style="background:#D1FAE5; color:#065F46; padding:2px 8px; border-radius:4px; font-size:0.75rem; font-weight:700;">15% COMM</span>
        </div>
    </div>
    <div id="lvlMsg" style="font-size:0.8rem; margin:10px 0; color:var(--text-muted);">0 / 5 Sales to Silver</div>
    <div style="background:#E5E7EB; height:10px; border-radius:10px; overflow:hidden;"> <!-- overflow:hidden keeps the bar inside -->
        <div id="lvlBar" style="background:#F59E0B; height:100%; width:0%; border-radius:10px; transition:width 0.5s ease;"></div>
    </div>
</div>
            
            <div class="dash-card" style="background: #FFFBEB; border: 1px solid #FEF3C7;">
                <h4 style="color: #92400E; margin-bottom: 8px;">üì¢ Payout Rules</h4>
                <ul style="font-size: 0.75rem; color: #92400E; list-style: disc; padding-left: 15px;">
                    <li>Minimum payout is <strong>‚Çπ500</strong>.</li>
                    <li>Valid Bank/UPI details are mandatory.</li>
                    <li>Commission on <strong>MRP (299/599)</strong>.</li>
                </ul>
                <button onclick="document.getElementById('fullTermsModal').style.display='block'" style="margin-top: 10px; background: none; border: none; color: #D97706; text-decoration: underline; font-size: 0.75rem; cursor: pointer;">Read Full Policy</button>
            </div>
        </div>

        <div class="dash-header" style="flex-direction: column; align-items: stretch;">
            <div style="display:flex; justify-content:space-between; align-items: center; width:100%; margin-bottom: 15px;">
                <h3 style="margin:0;">My Banking Details</h3>
                <button onclick="openBankModal()" class="nav-btn" style="padding:6px 14px; font-size:0.8rem;">Edit Details</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; font-size:0.9rem; background: #f9fafb; padding: 15px; border-radius: 8px;">
                <div><p style="color:gray; font-size:0.75rem;">Bank & Holder</p><strong><span id="d_bank"></span></strong><br><strong id="d_holder"></strong></div>
                <div><p style="color:gray; font-size:0.75rem;">Account & UPI</p>Acct: <strong id="d_acct"></strong><br>IFSC: <strong id="d_ifsc"></strong><br>UPI: <strong id="d_upi"></strong></div>
            </div>
        </div>

        <h3>Sales History <span id="pageInfo" style="font-size:0.8rem; color:gray;"></span></h3>
        <div style="overflow-x:auto; margin-top:1rem;">
            <table class="dash-table">
                <thead><tr><th>Date</th><th>Plan</th><th>Amount</th><th>Status</th><th>Key</th><th>Action</th></tr></thead>
                <tbody id="dashTableBody"></tbody>
            </table>
        </div>
        <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
            <button id="prevBtn" onclick="changePage(-1)" class="nav-btn" style="background:gray;">Previous</button>
            <button id="nextBtn" onclick="changePage(1)" class="nav-btn">Next</button>
        </div>
    </div>

    <!-- MODALS -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" onclick="closeLoginModal()">&times;</span>
            <h2 style="text-align:center; margin-bottom:20px;">Portal Login</h2>
            <div class="login-tabs">
                <button class="tab-btn active" onclick="switchTab('distributor')">Distributor</button>
                <button class="tab-btn" onclick="switchTab('admin')">Admin</button>
            </div>
            <form id="distForm" class="login-form" style="display:block;">
                <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
                <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
                <button type="submit" class="btn-buy primary">Login</button>
            </form>
            <form id="adminForm" class="login-form">
                <div class="form-group"><label>Admin Username</label><input type="text" name="username" required></div>
                <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
                <button type="submit" class="btn-buy primary" style="background:#111827;">Login Admin</button>
            </form>
        </div>
    </div>

    <div id="fullTermsModal" class="modal">
        <div class="modal-content" style="max-width: 550px;">
            <span class="close-icon" onclick="document.getElementById('fullTermsModal').style.display='none'">&times;</span>
            <h2 style="text-align:center;">Partner & Payout Policy</h2>
            <div style="font-size: 0.85rem; line-height: 1.6; margin-top:15px; max-height: 60vh; overflow-y: auto;">
                <p><strong>1. Payouts:</strong> Minimum threshold is <strong>‚Çπ500</strong>. Balance is updated immediately after sale.</p>
                <p><strong>2. Commission:</strong> Calculated on MRP (‚Çπ299/‚Çπ599). Your current level determines your rate (15% - 35%).</p>
                <p><strong>3. Levels:</strong> Updated on the 1st of every month based on previous month's performance.</p>
                <p><strong>4. Verification:</strong> Valid Bank Details are mandatory for payouts. Company is not liable for incorrect details.</p>
            </div>
            <button class="btn-buy primary" style="margin-top:20px;" onclick="document.getElementById('fullTermsModal').style.display='none'">I Understand</button>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" onclick="document.getElementById('registerModal').style.display='none'">&times;</span>
            <h2>Join as Partner</h2>
            <form id="regForm" onsubmit="return false;" style="margin-top:15px;">
                <div class="form-group"><label>Name</label><input type="text" name="name" required></div>
                <div class="form-group"><label>Phone</label><input type="text" name="phone" required></div>
                <div class="form-group"><label>Email</label><input type="email" id="regEmail" required></div>
                <button type="button" onclick="sendRegOtp()" class="btn-buy secondary" style="margin-bottom:10px;">Send Verification OTP</button>
                <div id="otpInputSection" style="display:none; background:#F9FAFB; padding:10px; border-radius:8px;">
                    <input type="text" id="regOtp" placeholder="Enter OTP" style="width:100%; padding:10px; margin-bottom:10px;">
                    <button type="button" onclick="verifyRegOtp()" class="btn-buy primary">Verify Email</button>
                </div>
                <div id="regPassSection" style="display:none; margin-top:10px;">
                    <div class="form-group"><label>Set Password</label><input type="password" id="regPass"></div>
                    <button type="button" id="finalRegBtn" class="btn-buy primary">Complete Registration</button>
                </div>
            </form>
        </div>
    </div>

    <div id="bankModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" onclick="document.getElementById('bankModal').style.display='none'">&times;</span>
            <h2 style="text-align:center;">Update Bank Details</h2>
            <form id="bankForm" style="margin-top:15px;">
                <div class="form-group"><label>Bank Name</label><input type="text" name="bank_name" id="in_bank"></div>
                <div class="form-group"><label>Holder Name</label><input type="text" name="account_holder" id="in_holder"></div>
                <div class="form-group"><label>Account Number</label><input type="text" name="account_number" id="in_acct"></div>
                <div class="form-group"><label>IFSC Code</label><input type="text" name="ifsc_code" id="in_ifsc"></div>
                <div class="form-group"><label>UPI ID</label><input type="text" name="upi_id" id="in_upi"></div>
                <button type="submit" class="btn-buy primary">Save Details</button>
            </form>
        </div>
    </div>

    <div id="licenseModal" class="modal"><div class="modal-content" style="text-align:center;"><h2>üéâ Payment Success!</h2><p>Download your license below.</p><div id="licenseKeyArea" style="background:#F3F4F6; padding:1rem; border:2px dashed #CCC; margin:1rem 0; font-family:monospace;"></div><button class="btn-buy secondary" onclick="location.reload()">Close</button></div></div>

    <script>
        const BACKEND_URL = "https://zarqeen-backend.onrender.com";
        document.getElementById('year').textContent = new Date().getFullYear();

        function toggleMobileMenu() { document.getElementById('mobileNav').classList.toggle('active'); }
        function openLoginModal() { document.getElementById('loginModal').style.display = 'block'; }
        function closeLoginModal() { document.getElementById('loginModal').style.display = 'none'; }
        function openRegisterModal() { document.getElementById('registerModal').style.display = 'block'; }
        function openBankModal() { document.getElementById('bankModal').style.display = 'block'; }
        function showLoader(t) { document.getElementById('actionLoader').style.display = 'flex'; document.getElementById('loaderText').innerText = t || "Loading..."; }
        function hideLoader() { document.getElementById('actionLoader').style.display = 'none'; }

        async function syncDownloadLink() {
            try {
                const res = await fetch(`${BACKEND_URL}/api/download-link`);
                const data = await res.json();
                if (data.download_url) {
                    document.querySelectorAll('a.dynamic-dl').forEach(el => el.href = data.download_url);
                }
            } catch (e) { console.log("Link sync error"); }
        }
        window.addEventListener('load', syncDownloadLink);

        function checkDownload(event) {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                event.preventDefault();
                Swal.fire({ title: 'Windows PC Required', text: 'Zarqeen Alif is a desktop application. Please download on your Windows computer.', icon: 'info' });
            }
        }

        function switchTab(type) {
            const tabs = document.querySelectorAll('.tab-btn');
            const distForm = document.getElementById('distForm');
            const adminForm = document.getElementById('adminForm');
            if (type === 'distributor') {
                distForm.style.display = 'block'; adminForm.style.display = 'none';
                tabs[0].classList.add('active'); tabs[1].classList.remove('active');
            } else {
                distForm.style.display = 'none'; adminForm.style.display = 'block';
                tabs[1].classList.add('active'); tabs[0].classList.remove('active');
            }
        }

        let ACTIVE_DISTRIBUTOR_CODE = null;
        async function applyCode() {
            const code = document.getElementById('distCode').value.trim(); if(!code) return;
            showLoader("Checking...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/check_distributor`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ code }) });
                const data = await res.json(); hideLoader();
                if (data.valid) {
                    ACTIVE_DISTRIBUTOR_CODE = code;
                    document.getElementById('codeMsg').innerText = `‚úÖ ${data.name} applied (${data.discount}% OFF)`;
                    document.getElementById('codeMsg').style.color = 'green';
                } else {
                    document.getElementById('codeMsg').innerText = "‚ùå Invalid Code";
                    document.getElementById('codeMsg').style.color = 'red';
                }
            } catch (e) { hideLoader(); }
        }

        async function buyPlan(planType) {
            showLoader("Starting Payment...");
            try {
                const configRes = await fetch(`${BACKEND_URL}/api/get-config`);
                const config = await configRes.json();
                const res = await fetch(`${BACKEND_URL}/create_order`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ plan: planType, distributor_code: ACTIVE_DISTRIBUTOR_CODE }) });
                const orderData = await res.json(); hideLoader();
                
                const options = {
                    "key": config.key_id, "amount": orderData.amount, "currency": "INR", "name": "Zarqeen Alif", "order_id": orderData.id,
                    "handler": async function (response){
                        showLoader("Verifying...");
                        const verifyRes = await fetch(`${BACKEND_URL}/verify_payment`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({...response, plan_type: planType}) });
                        const result = await verifyRes.json(); hideLoader();
                        if(result.success) {
                            const blob = new Blob([result.license_key], { type: "text/plain" });
                            const url = window.URL.createObjectURL(blob);
                            document.getElementById('licenseKeyArea').innerHTML = `<a href="${url}" download="license.zarqeen" class="nav-btn">‚¨á Download License File</a>`;
                            document.getElementById('licenseModal').style.display='block';
                        }
                    }
                };
                new Razorpay(options).open();
            } catch(e) { hideLoader(); alert("Error connecting to payment gateway"); }
        }

        document.getElementById('distForm').onsubmit = async (e) => {
            e.preventDefault(); showLoader("Logging in...");
            const data = Object.fromEntries(new FormData(e.target));
            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/login`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
                const r = await res.json(); hideLoader();
                if(r.success) { localStorage.setItem('dist_token', r.token); closeLoginModal(); loadDashboard(1); } else alert(r.message);
            } catch(e) { hideLoader(); }
        };

        document.getElementById('adminForm').onsubmit = async (e) => {
            e.preventDefault(); showLoader("Verifying Admin...");
            const data = Object.fromEntries(new FormData(e.target));
            try {
                const res = await fetch(`${BACKEND_URL}/admin/login`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data), credentials: 'include' });
                const r = await res.json(); hideLoader();
                if(r.success) { setTimeout(() => { window.location.href = r.redirect; }, 500); } else alert(r.message);
            } catch(e) { hideLoader(); }
        };

        let CURRENT_PAGE = 1;
        async function loadDashboard(page) {
            CURRENT_PAGE = page; const token = localStorage.getItem('dist_token'); if(!token) return;
            showLoader("Loading Portal...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/data?page=${page}`, { headers: {'Authorization': `Bearer ${token}`} });
                const data = await res.json(); hideLoader();
                if(res.status === 401) return doLogout();

                document.getElementById('dashName').innerText = data.name; document.getElementById('dashCode').innerText = data.code;
                const p = data.progress;
if(p) {
    document.getElementById('lvlName').innerText = p.current_level;
    document.getElementById('lvlDisc').innerText = `${data.discount}% OFF`;
    
    // 1. Update the level-based commission percent (15, 25, or 35)
    document.getElementById('lvlCommRate').innerText = `${data.commission_pct}% COMM`;

    // 2. Fix the Progress Bar overflow
    // Math.min ensures the width never goes above 100% even if sales exceed target
    const progressPercent = p.is_max ? 100 : Math.min((p.month_sales / p.target) * 100, 100);
    
    document.getElementById('lvlMsg').innerText = p.is_max ? "Max Level Reached! üèÜ" : `${p.month_sales} / ${p.target} Sales to ${p.next_level}`;
    document.getElementById('lvlBar').style.width = `${progressPercent}%`;
    
    // 3. Optional: Visual feedback - Turn bar green if target reached
    document.getElementById('lvlBar').style.background = (progressPercent >= 100) ? "#10B981" : "#F59E0B";
}

                let bonusHtml = data.bonus_percent > 0 ? `<div style="margin-top:10px; padding:8px; background:#ECFDF5; color:#065F46; border-radius:6px; font-size:0.75rem;">‚ú® <strong>${data.bonus_name}:</strong> +${data.bonus_percent}% Bonus Active!</div>` : "";
                document.getElementById('dashTotal').innerText = data.total_sales;
                document.getElementById('dashComm').innerHTML = `<span style="color:#2563EB">Earned: ‚Çπ${data.commission_earned.toFixed(2)}</span><br><span style="color:gray; font-size:0.8rem;">Received: ‚Çπ${data.commission_paid.toFixed(2)}</span><br><strong style="color:red">Balance: ‚Çπ${data.balance_due.toFixed(2)}</strong>${bonusHtml}`;

                const b = data.bank_info; document.getElementById('d_bank').innerText = b.bank_name||'-'; document.getElementById('d_holder').innerText = b.account_holder||'-'; document.getElementById('d_acct').innerText = b.account_number||'-'; document.getElementById('d_ifsc').innerText = b.ifsc||'-'; document.getElementById('d_upi').innerText = b.upi||'-';
                
                const tbody = document.getElementById('dashTableBody'); tbody.innerHTML = "";
                data.sales_history.forEach(s => { tbody.innerHTML += `<tr><td>${s.date}</td><td>${s.plan}</td><td>‚Çπ${s.amount}</td><td>${s.status}</td><td style="font-family:monospace">${s.key}</td><td><a href="${data.backend_url}download/license/${s.key}" class="nav-btn" style="padding:4px 8px;">‚¨á</a></td></tr>`; });
                
                document.getElementById('pageInfo').innerText = `Page ${page} of ${data.pagination.total_pages}`;
                document.getElementById('prevBtn').style.display = data.pagination.has_prev ? 'block' : 'none';
                document.getElementById('nextBtn').style.display = data.pagination.has_next ? 'block' : 'none';

                ['header', '.hero', '#features', '#target-businesses', '#pricing', 'footer'].forEach(s => { const el = document.querySelector(s); if(el) el.style.display = 'none'; });
                document.getElementById('dashboardSection').style.display = 'block';
                window.scrollTo(0,0);
            } catch(e) { hideLoader(); }
        }

        function changePage(d) { loadDashboard(CURRENT_PAGE + d); }
        function doLogout() { localStorage.removeItem('dist_token'); location.reload(); }
        window.addEventListener('DOMContentLoaded', () => { if(localStorage.getItem('dist_token')) loadDashboard(1); });

        // Registration Logic
        let regData = {};
        async function sendRegOtp() {
            const name = document.querySelector('[name="name"]').value;
            const email = document.getElementById('regEmail').value;
            if(!name || !email) return alert("Fill Name and Email");
            showLoader("Sending OTP...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/register`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name, email, phone: document.querySelector('[name="phone"]').value, password: "TEMP" }) });
                const r = await res.json(); hideLoader();
                if(r.success) { regData.email = email; document.getElementById('otpInputSection').style.display='block'; } else alert(r.message);
            } catch(e) { hideLoader(); }
        }

        async function verifyRegOtp() {
            const otp = document.getElementById('regOtp').value;
            showLoader("Verifying...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/verify-registration`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ email: regData.email, otp }) });
                const r = await res.json(); hideLoader();
                if(r.success) { regData.otp = otp; document.getElementById('otpInputSection').style.display='none'; document.getElementById('regPassSection').style.display='block'; } else alert(r.message);
            } catch(e) { hideLoader(); }
        }

        document.getElementById('finalRegBtn').onclick = async () => {
            const pw = document.getElementById('regPass').value;
            showLoader("Finishing...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/reset-with-otp`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ email: regData.email, otp: regData.otp, new_password: pw }) });
                const r = await res.json(); hideLoader();
                if(r.success) { alert("Success! Please Login."); location.reload(); } else alert(r.message);
            } catch(e) { hideLoader(); }
        }

        document.getElementById('bankForm').onsubmit = async (e) => {
            e.preventDefault(); const token = localStorage.getItem('dist_token');
            const data = Object.fromEntries(new FormData(e.target));
            showLoader("Saving...");
            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/update-bank`, { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`}, body: JSON.stringify(data) });
                if((await res.json()).success) { alert("Updated!"); document.getElementById('bankModal').style.display='none'; loadDashboard(1); }
            } catch(e) { hideLoader(); }
        };
    </script>
</body>
</html>
