<!-- ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸëŸéŸáŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê  -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zarqeen Alif - India's Best Value Invoicing Software</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="static/header.png">

    <style>
        :root {
            --primary: #2563EB;
            --primary-dark: #1E40AF;
            --accent: #F59E0B;
            --bg-light: #F3F4F6;
            --text-main: #111827;
            --text-muted: #6B7280;
            --white: #ffffff;
            --success: #10B981;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        body { background-color: var(--bg-light); color: var(--text-main); line-height: 1.6; }
        a { text-decoration: none; }
        ul { list-style: none; }
        
        header { background: var(--white); box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .logo-img { height: 45px; width: auto; }
        .brand-name { font-weight: 800; font-size: 1.35rem; color: var(--primary-dark); tracking: -0.5px; }
        .nav-links { display: flex; align-items: center; gap: 2rem; }
        .nav-links a { color: var(--text-muted); font-weight: 600; font-size: 0.95rem; transition: color 0.2s; cursor: pointer; }
        .nav-links a:hover { color: var(--primary); }
        .nav-btn { background: var(--primary); color: var(--white) !important; padding: 0.6rem 1.2rem; border-radius: 8px; transition: background 0.2s; }
        .nav-btn:hover { background: var(--primary-dark); }
        
        /* Hero & Sections */
        .hero { text-align: center; padding: 5rem 1rem 4rem; background: linear-gradient(180deg, #FFFFFF 0%, #EFF6FF 100%); border-bottom: 1px solid #DBEAFE; }
        .tagline { display: inline-block; background: #DBEAFE; color: var(--primary-dark); padding: 6px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 700; margin-bottom: 1.5rem; border: 1px solid #BFDBFE; }
        .hero h1 { font-size: 3rem; font-weight: 800; color: #111827; line-height: 1.2; margin-bottom: 1.5rem; letter-spacing: -1px; }
        .hero h1 span { color: var(--primary); }
        .hero p { font-size: 1.2rem; color: var(--text-muted); max-width: 700px; margin: 0 auto 2.5rem; }
        .cta-group { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        
        .btn-lg { padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: transform 0.2s; }
        .btn-lg:hover { transform: translateY(-2px); }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-outline { background: var(--white); color: var(--text-main); border: 1px solid #D1D5DB; }
        .specs { font-size: 0.85rem; color: var(--text-muted); margin-top: 1.5rem; opacity: 0.8; }
        
        .features { max-width: 1200px; margin: -3rem auto 3rem; padding: 0 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; position: relative; z-index: 10; }
        .feature-card { background: var(--white); padding: 2rem; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); border: 1px solid #E5E7EB; transition: transform 0.2s; }
        .feature-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .icon-box { font-size: 2rem; margin-bottom: 1rem; background: #EFF6FF; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .feature-card h3 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: #1F2937; }
        
        .pricing-section { padding: 4rem 1rem; text-align: center; }
        .section-title { font-size: 2.25rem; font-weight: 800; margin-bottom: 0.5rem; }
        .section-subtitle { color: var(--text-muted); margin-bottom: 3rem; font-size: 1.1rem; }
        
        .dist-input-container { max-width: 400px; margin: 0 auto 2rem; text-align: center; }
        .dist-input-box { display: flex; gap: 10px; justify-content: center; margin-top: 5px; }
        .dist-input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; width: 60%; text-transform: uppercase; font-weight: bold; }
        
        .pricing-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; align-items: start; }
        .plan-card { background: var(--white); padding: 2.5rem; border-radius: 16px; border: 1px solid #E5E7EB; position: relative; display: flex; flex-direction: column; height: 100%; transition: 0.3s; }
        .plan-card.popular { border: 2px solid var(--primary); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); transform: scale(1.05); z-index: 2; }
        .badge { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--accent); color: #78350F; padding: 6px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; }
        .plan-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #1F2937; }
        .price { font-size: 3rem; font-weight: 800; color: #111827; }
        .price span { font-size: 1rem; color: var(--text-muted); font-weight: 500; }
        .plan-desc { color: var(--text-muted); margin-bottom: 2rem; font-size: 0.95rem; border-bottom: 1px solid #E5E7EB; padding-bottom: 1.5rem; }
        .features-list { list-style: none; text-align: left; margin-bottom: 2rem; }
        .features-list li { margin-bottom: 0.8rem; color: #374151; display: flex; align-items: center; gap: 10px; font-size: 0.95rem; }
        .features-list li::before { content: "‚úì"; color: var(--success); font-weight: 800; }
        
        .btn-buy { width: 100%; padding: 1rem; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; border: none; transition: 0.2s; margin-top: auto; }
        .btn-buy.primary { background: var(--primary); color: var(--white); box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2); }
        .btn-buy.primary:hover { background: var(--primary-dark); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); }
        .btn-buy.secondary { background: #E5E7EB; color: #374151; }
        .btn-buy.secondary:hover { background: #D1D5DB; }
        
        footer { margin-top: 4rem; padding: 3rem 1rem; background: var(--white); border-top: 1px solid #E5E7EB; text-align: center; }

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); animation: fadeIn 0.2s; }
        .modal-content { background-color: var(--white); margin: 10vh auto; padding: 2rem; border-radius: 12px; width: 90%; max-width: 450px; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .close-icon { position: absolute; right: 20px; top: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        .key-box { background: #F3F4F6; padding: 1rem; border: 2px dashed #D1D5DB; border-radius: 8px; margin: 1.5rem 0; font-family: monospace; font-size: 1.1rem; color: var(--primary-dark); word-break: break-all; }
        
        /* LOGIN TABS */
        .login-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #E5E7EB; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; font-weight: 600; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
        
        .login-form { display: none; }
        .login-form.active { display: block; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-size: 0.9rem; margin-bottom: 5px; font-weight: 600; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; }

        /* DASHBOARD STYLES */
        #dashboardSection { display: none; padding: 2rem; background: #F3F4F6; min-height: 100vh; }
        .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .dash-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .dash-val { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .dash-table { width: 100%; background: white; border-radius: 12px; border-collapse: collapse; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .dash-table th, .dash-table td { padding: 15px; text-align: left; border-bottom: 1px solid #E5E7EB; }
        .dash-table th { background: #F9FAFB; font-weight: 600; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; }
        .status-installed { background: #D1FAE5; color: #065F46; }
        .status-pending { background: #FEE2E2; color: #991B1B; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hero h1 { font-size: 2.25rem; }
            .plan-card.popular { transform: none; }
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <header>
        <div class="nav-container">
            <div class="logo-area">
                <img src="static/logo.png" alt="Zarqeen" class="logo-img">
                <span class="brand-name">Zarqeen Alif</span>
            </div>
            <nav class="nav-links">
                <a href="#features">Features</a>
                <a href="#pricing">Pricing</a>
                <a onclick="openLoginModal()" style="color:var(--primary); cursor: pointer;">Login</a>
                <a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9?usp=drive_link" target="_blank" class="nav-btn">Download for Windows</a>
            </nav>
        </div>
    </header>

    <!-- HERO SECTION -->
    <section class="hero">
        <div class="tagline">
            <img src="https://flagcdn.com/w40/in.png" alt="India Flag" style="height: 14px; vertical-align: middle; margin-right: 5px;"> 
            MADE FOR INDIA
        </div>
        <h1>
            India's Best Value <br>
            <span>Invoicing Software</span>
        </h1>
        <p>
            The easiest offline billing software. Automatically calculates taxes. 
            Designed specifically for Indian businesses who want simplicity and speed.
        </p>
        
        <div class="cta-group">
            <a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9?usp=drive_link" target="_blank">
                <button class="btn-lg btn-primary">Download Free Trial</button>
            </a>
            <a href="#pricing">
                <button class="btn-lg btn-outline">See Best Prices</button>
            </a>
        </div>
        
        <div class="specs">
            v1.1.0 ‚Ä¢ Supports A4, A5, Thermal 2" & 3" ‚Ä¢ 200MB ‚Ä¢ No Internet Required
        </div>
    </section>

    <!-- FEATURES SECTION -->
    <section id="features" class="features">
        <div class="feature-card">
            <div class="icon-box">‚ö°</div>
            <h3>Lightning Fast & Offline</h3>
            <p>Generates bills in seconds. Works 100% offline so your data stays safe on your own computer. No cloud fees.</p>
        </div>
        
        <!-- NEW TEMPLATE FEATURE -->
        <div class="feature-card">
            <div class="icon-box">üñ®Ô∏è</div>
            <h3>All Paper Sizes</h3>
            <p>Supports A4, A5, and Thermal Printers (2-inch & 3-inch). Print perfectly on any device.</p>
        </div>

       
        <div class="feature-card">
            <div class="icon-box">
                <img src="https://flagcdn.com/w80/in.png" alt="India Flag" style="width: 35px; height: auto;">
            </div>
            <h3>Exclusively for India</h3>
            <p>Built specifically for the Indian market. Pre-loaded with Indian State codes and currency formats.</p>
        </div>
    </section>

    <!-- PRICING SECTION -->
    <section id="pricing" class="pricing-section">
        <h2 class="section-title">Unbeatable Pricing</h2>
        <p class="section-subtitle">The cheapest and most reliable software in India.</p>

        <!-- DISTRIBUTOR CODE INPUT -->
        <div class="dist-input-container">
            <p style="margin-bottom: 10px; font-weight: 600;">Have a Distributor Code?</p>
            <div class="dist-input-box">
                <input type="text" id="distCode" class="dist-input" placeholder="Enter Code (e.g. ZARQEEN10)">
                <button onclick="applyCode()" class="nav-btn" style="cursor: pointer;">Apply</button>
            </div>
            <p id="codeMsg" style="font-size: 0.9rem; margin-top: 5px; min-height: 20px;"></p>
        </div>

        <div class="pricing-grid">
            
            <!-- Free Plan -->
            <div class="plan-card">
                <div class="plan-header">
                    <div class="plan-name">Trial</div>
                    <div class="price">Free</div>
                    <p class="plan-desc">7 Days unlimited access</p>
                </div>
                <ul class="features-list">
                    <li>1000 Invoices</li>
                    <li>Single user only</li>
                    <li>All other premium features</li>
                    <li>No Credit Card required</li>
                </ul>
                <a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9?usp=drive_link" target="_blank" style="margin-top: auto;">
                    <button class="btn-buy secondary">Download Now</button>
                </a>
            </div>

            <!-- Basic Plan -->
            <div class="plan-card">
                <div class="plan-header">
                    <div class="plan-name">Basic</div>
                    <div class="price">‚Çπ299<span>/year</span></div>
                    <p class="plan-desc">Ideal for new customers</p>
                </div>
                <ul class="features-list">
                    <li>Valid for 1 Year</li>
                    <li>2 Staff Accounts</li>
                    <li>Automatic Tax Calc</li>
                    <li>Email Support</li>
                </ul>
                <button class="btn-buy primary" onclick="buyPlan('basic')">Buy Basic License</button>
            </div>

            <!-- Premium Plan -->
            <div class="plan-card popular">
                <div class="badge">BEST VALUE</div>
                <div class="plan-header">
                    <div class="plan-name">Premium</div>
                    <div class="price">‚Çπ599<span>/3 years</span></div>
                    <p class="plan-desc">For smart business owners</p>
                </div>
                <ul class="features-list">
                    <li><strong>Valid for 3 Years</strong></li>
                    <li>Unlimited Staff</li>
                    <li>Priority Support</li>
                    <li>Free Updates</li>
                    <li>Automatic Tax Calc</li>
                </ul>
                <button class="btn-buy primary" onclick="buyPlan('premium')">Buy Premium License</button>
            </div>

        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <p>&copy; <span id="year"></span> Zarqeen Accounting Solutions.</p>
        <p style="margin-top:10px; font-size: 0.9rem;">
            Support: <a href="mailto:zarqeensoftware@gmail.com" style="color:var(--primary); font-weight:600;">zarqeensoftware@gmail.com</a>
        </p>
        <div class="footer-admin">
            <a onclick="openLoginModal()" style="cursor: pointer;">Admin / Distributor Login</a>
        </div>
    </footer>

    <!-- DISTRIBUTOR DASHBOARD (Hidden by Default) -->
    <div id="dashboardSection">
        <div style="max-width: 1200px; margin: 0 auto;">
            
            <!-- Header -->
            <div class="dash-header">
                <div>
                    <h2 id="dashName">Distributor Name</h2>
                    <p style="color: #6B7280;">Code: <strong id="dashCode">CODE</strong></p>
                </div>
                <button onclick="doLogout()" class="btn-buy secondary" style="width: auto; margin:0; background: #EF4444; color: white;">Logout</button>
            </div>

            <!-- Stats -->
            <div class="dash-grid">
                <div class="dash-card">
                    <div class="dash-val" id="dashTotal">0</div>
                    <div style="color: #6B7280;">Total Licenses Sold</div>
                </div>
                <div class="dash-card">
                    <div class="dash-val">‚Çπ<span id="dashComm">0</span></div>
                    <div style="color: #6B7280;">Your Commission (Est.)</div>
                </div>
                <div class="dash-card">
                    <div class="dash-val"><span id="dashDisc">0</span>%</div>
                    <div style="color: #6B7280;">Current Discount</div>
                </div>
            </div>

            <!-- Table -->
            <h3 style="margin-bottom: 15px;">Sales History</h3>
            <table class="dash-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Plan</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>License Key</th>
                    </tr>
                </thead>
                <tbody id="dashTableBody">
                    <!-- Rows injected by JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 1. PAYMENT SUCCESS MODAL -->
    <div id="licenseModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 3.5rem; margin-bottom: 10px;">üéâ</div>
            <h2 style="color: #059669; font-weight: 800;">Payment Successful!</h2>
            <p style="color: var(--text-muted); margin-top: 10px;">Here is your license file. Download and upload it inside the software.</p>
            <div id="licenseKeyArea" class="key-box">Generating...</div>
            <button class="btn-buy secondary" onclick="closeLicenseModal()">Close</button>
        </div>
    </div>

    <!-- 2. LOGIN MODAL -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" onclick="closeLoginModal()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px;">Portal Login</h2>
            
            <div class="login-tabs">
                <button class="tab-btn active" onclick="switchTab('distributor')">Distributor</button>
                <button class="tab-btn" onclick="switchTab('admin')">Admin</button>
            </div>

            <!-- DISTRIBUTOR FORM (AJAX) -->
            <form id="distForm" class="login-form active">
                <div class="form-group">
                    <label>Distributor Username</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn-buy primary">Login as Distributor</button>
            </form>

            <!-- ADMIN FORM (POST) -->
            <form id="adminForm" class="login-form" method="POST">
                <div class="form-group">
                    <label>Admin Username</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn-buy primary" style="background: #111827;">Login as Admin</button>
            </form>

        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // 1. CONFIGURATION
        document.getElementById('year').textContent = new Date().getFullYear();
        let RAZORPAY_KEY_ID = null; 
        
        // ‚ö†Ô∏è BACKEND URL (Ensure this matches your Render URL)
        const BACKEND_URL = "https://zarqeen-backend.onrender.com"; 

        // 2. SETUP ADMIN FORM (Redirects to backend)
        document.getElementById('adminForm').action = `${BACKEND_URL}/admin/login`;

        // 3. FETCH CONFIG
        async function fetchConfig() {
            try {
                const res = await fetch(`${BACKEND_URL}/api/get-config`);
                if (!res.ok) throw new Error("Backend not reachable");
                const data = await res.json();
                RAZORPAY_KEY_ID = data.key_id; 
                console.log("System Ready.");
            } catch (error) {
                console.error("Backend offline:", error);
                // Optional: Alert user if backend is down on load
            }
        }
        fetchConfig();

        // 4. UI FUNCTIONS (MODALS)
        function closeLicenseModal() {
            document.getElementById('licenseModal').style.display = 'none';
            window.location.reload(); 
        }

        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function switchTab(type) {
            const distForm = document.getElementById('distForm');
            const adminForm = document.getElementById('adminForm');
            const btns = document.querySelectorAll('.tab-btn');
            
            if(type === 'distributor') {
                distForm.classList.add('active');
                adminForm.classList.remove('active');
                btns[0].classList.add('active');
                btns[1].classList.remove('active');
            } else {
                distForm.classList.remove('active');
                adminForm.classList.add('active');
                btns[0].classList.remove('active');
                btns[1].classList.add('active');
            }
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const mod1 = document.getElementById('licenseModal');
            const mod2 = document.getElementById('loginModal');
            if (event.target == mod1) mod1.style.display = "none";
            if (event.target == mod2) mod2.style.display = "none";
        }

        function resetUI() {
            document.body.style.cursor = 'default';
            const btns = document.querySelectorAll('button');
            btns.forEach(b => b.disabled = false);
        }

        // 5. DISTRIBUTOR CODE LOGIC
        let ACTIVE_DISTRIBUTOR_CODE = null;

        async function applyCode() {
            const codeInput = document.getElementById('distCode');
            const msg = document.getElementById('codeMsg');
            const code = codeInput.value.trim();

            if(!code) return;

            msg.textContent = "Checking...";
            msg.style.color = "grey";

            try {
                const res = await fetch(`${BACKEND_URL}/api/check_distributor`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code: code })
                });
                const data = await res.json();

                if (data.valid) {
                    ACTIVE_DISTRIBUTOR_CODE = code;
                    msg.textContent = `‚úÖ Success! ${data.name} discount applied (${data.discount}% OFF)`;
                    msg.style.color = "green";
                    codeInput.style.borderColor = "green";
                } else {
                    ACTIVE_DISTRIBUTOR_CODE = null;
                    msg.textContent = "‚ùå Invalid Code";
                    msg.style.color = "red";
                    codeInput.style.borderColor = "red";
                }
            } catch (e) {
                console.error(e);
                msg.textContent = "Error checking code";
            }
        }

        // 6. BUY LOGIC
        async function buyPlan(planType) {
            if (!RAZORPAY_KEY_ID) {
                alert("Trying to connect to payment server... please wait 2 seconds and click again.");
                await fetchConfig(); // Try fetching again
                return;
            }

            document.body.style.cursor = 'wait';
            const btns = document.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);

            try {
                // Create Order
                const res = await fetch(`${BACKEND_URL}/create_order`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        plan: planType,
                        distributor_code: ACTIVE_DISTRIBUTOR_CODE
                    })
                });
                
                if (!res.ok) throw new Error(`Server error: ${res.status}`);
                const orderData = await res.json();
                if(orderData.error) throw new Error(orderData.error);

                // Open Razorpay
                const options = {
                    "key": RAZORPAY_KEY_ID,
                    "amount": orderData.amount,
                    "currency": "INR",
                    "name": "Zarqeen Alif",
                    "description": `License: ${planType.toUpperCase()}`,
                    "order_id": orderData.id,
                    "theme": { "color": "#2563EB" }, 
                    "handler": async function (response){
                        try {
                            const verifyRes = await fetch(`${BACKEND_URL}/verify_payment`, {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_order_id: response.razorpay_order_id,
                                    razorpay_signature: response.razorpay_signature,
                                    plan_type: planType
                                })
                            });
                            const result = await verifyRes.json();
                            
                            if(result.success) {
                                // Download File Logic
                                const licenseKey = result.license_key;
                                const blob = new Blob([licenseKey], { type: "text/plain" });
                                const url = window.URL.createObjectURL(blob);
                                
                                const keyArea = document.getElementById('licenseKeyArea');
                                keyArea.innerHTML = ""; 
                                
                                const downloadBtn = document.createElement("a");
                                downloadBtn.href = url;
                                downloadBtn.download = "license.zarqeen"; 
                                downloadBtn.className = "btn-buy primary";
                                downloadBtn.style.display = "inline-block";
                                downloadBtn.style.textDecoration = "none";
                                downloadBtn.innerText = "‚¨á Download License File";
                                
                                keyArea.appendChild(downloadBtn);
                                document.getElementById('licenseModal').style.display = 'block';
                            } else {
                                alert('Verification failed. Contact support.');
                            }
                        } catch (e) {
                            alert("Verification error. Check internet.");
                        } finally {
                            resetUI();
                        }
                    },
                    "modal": { "ondismiss": function(){ resetUI(); } }
                };
                
                const rzp1 = new Razorpay(options);
                rzp1.open();

            } catch(e) {
                console.error(e);
                alert("Connection Error: Check if backend is running. " + e.message);
                resetUI();
            }
        }

        // 7. DISTRIBUTOR HEADLESS LOGIN (TOKEN BASED)
        
        // A. Handle Login Submit
        document.getElementById('distForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            const btn = this.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = "Logging in...";
            btn.disabled = true;

            try {
                const res = await fetch(`${BACKEND_URL}/api/distributor/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await res.json();
                
                if (result.success) {
                    // SAVE TOKEN TO BROWSER STORAGE
                    localStorage.setItem('dist_token', result.token);
                    
                    closeLoginModal();
                    loadDashboard(); 
                } else {
                    alert(result.message || "Login failed");
                }
            } catch (error) {
                console.error(error);
                alert("Connection error: Ensure Backend is live and DB is reset.");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        // B. Fetch Data & Show Dashboard
        async function loadDashboard() {
            try {
                const token = localStorage.getItem('dist_token');
                
                if (!token) {
                    // No token found, user must login
                    return; 
                }

                // SEND TOKEN IN HEADERS
                const res = await fetch(`${BACKEND_URL}/api/distributor/data`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (res.status === 401) {
                    alert("Session expired. Please login again.");
                    doLogout();
                    return;
                }

                const data = await res.json();

                // Populate Stats
                document.getElementById('dashName').innerText = data.name;
                document.getElementById('dashCode').innerText = data.code;
                document.getElementById('dashTotal').innerText = data.total_sales;
                document.getElementById('dashComm').innerText = data.commission;
                document.getElementById('dashDisc').innerText = data.discount;

                // Populate Table
                const tbody = document.getElementById('dashTableBody');
                tbody.innerHTML = ""; 

                if (data.sales_history.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:gray;">No sales found.</td></tr>`;
                } else {
                    data.sales_history.forEach(row => {
                        const statusClass = row.status === 'INSTALLED' ? 'status-installed' : 'status-pending';
                        const html = `
                            <tr>
                                <td>${row.date}</td>
                                <td>${row.plan}</td>
                                <td>‚Çπ${row.amount}</td>
                                <td><span class="status-badge ${statusClass}">${row.status}</span></td>
                                <td style="font-family:monospace">${row.key}</td>
                            </tr>
                        `;
                        tbody.insertAdjacentHTML('beforeend', html);
                    });
                }

                // C. SWAP VIEW
                document.querySelector('header').style.display = 'none';
                document.querySelector('.hero').style.display = 'none';
                document.getElementById('features').style.display = 'none';
                document.getElementById('pricing').style.display = 'none';
                document.querySelector('footer').style.display = 'none';
                
                document.getElementById('dashboardSection').style.display = 'block';
                window.scrollTo(0, 0);

            } catch (e) {
                console.error(e);
                alert("Error loading dashboard data");
            }
        }

        // D. Logout Logic
        function doLogout() {
            localStorage.removeItem('dist_token'); // Delete Token
            window.location.reload(); 
        }

        // E. Check for existing login on page load
        window.addEventListener('load', function() {
            if(localStorage.getItem('dist_token')) {
                loadDashboard();
            }
        })
    </script>
</body>
</html>
