<!-- ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸëŸéŸáŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸÄŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê  -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zarqeen Alif - India's Best Value Invoicing Software</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link rel="icon" type="image/png" href="static/header.png">
    <style>
        :root { --primary: #2563EB; --primary-dark: #1E40AF; --accent: #F59E0B; --bg-light: #F3F4F6; --text-main: #111827; --text-muted: #6B7280; --white: #ffffff; --success: #10B981; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        body { background-color: var(--bg-light); color: var(--text-main); line-height: 1.6; }
        a { text-decoration: none; } ul { list-style: none; }
        
        #actionLoader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 999999; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #E5E7EB; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        header { background: var(--white); box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-links { display: flex; align-items: center; gap: 2rem; }
        .nav-links a { color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; }
        .nav-btn { background: var(--primary); color: var(--white) !important; padding: 0.6rem 1.2rem; border-radius: 8px; }
        
        .hero { text-align: center; padding: 5rem 1rem 4rem; background: linear-gradient(180deg, #FFFFFF 0%, #EFF6FF 100%); border-bottom: 1px solid #DBEAFE; }
        .pricing-section { padding: 4rem 1rem; text-align: center; }
        .pricing-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .plan-card { background: var(--white); padding: 2.5rem; border-radius: 16px; border: 1px solid #E5E7EB; display: flex; flex-direction: column; height: 100%; }
        .plan-card.popular { border: 2px solid var(--primary); transform: scale(1.05); }
        .price { font-size: 3rem; font-weight: 800; color: #111827; }
        
        .btn-buy { width: 100%; padding: 1rem; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; margin-top: auto; }
        .btn-buy.primary { background: var(--primary); color: var(--white); }
        .btn-buy.secondary { background: #E5E7EB; color: #374151; }
        
        .dist-input-container { max-width: 400px; margin: 0 auto 2rem; text-align: center; }
        .dist-input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; width: 60%; text-transform: uppercase; font-weight: bold; }
        
        /* MODALS */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); animation: fadeIn 0.2s; }
        .modal-content { background-color: var(--white); margin: 10vh auto; padding: 2rem; border-radius: 12px; width: 90%; max-width: 450px; position: relative; }
        .close-icon { position: absolute; right: 20px; top: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        
        .login-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #E5E7EB; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; font-weight: 600; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
        .login-form { display: none; }
        .login-form.active { display: block; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; margin-top:5px; margin-bottom:15px; }

        /* DASHBOARD */
        #dashboardSection { display: none; padding: 2rem; background: #F3F4F6; min-height: 100vh; }
        .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 12px; }
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .dash-card { background: white; padding: 20px; border-radius: 12px; }
        .dash-val { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .dash-table { width: 100%; background: white; border-radius: 12px; border-collapse: collapse; overflow: hidden; }
        .dash-table th, .dash-table td { padding: 15px; text-align: left; border-bottom: 1px solid #E5E7EB; }
        .dash-table th { background: #F9FAFB; font-weight: 600; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="actionLoader"><div class="spinner"></div><div id="loaderText" style="font-weight:600">Processing...</div></div>

    <header>
        <div class="nav-container">
            <div class="logo-area"><img src="static/logo.png" style="height:45px;"><span class="brand-name" style="margin-left:10px;font-size:1.3rem;font-weight:800;color:#1E40AF;">Zarqeen Alif</span></div>
            <nav class="nav-links">
                <a href="#features">Features</a><a href="#pricing">Pricing</a>
                <a onclick="openLoginModal()" style="color:var(--primary);">Login</a>
                <a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9" target="_blank" class="nav-btn">Download</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="tagline">MADE FOR INDIA</div>
        <h1>India's Best Value <br><span>Invoicing Software</span></h1>
        <p>The easiest offline billing software. Specially designed for Retail Indian Businesses.</p>
        <div class="cta-group">
            <a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9" target="_blank"><button class="btn-lg btn-primary" style="background:#2563EB;color:white;padding:1rem 2rem;border-radius:8px;border:none;cursor:pointer;">Download Free Trial</button></a>
            <a href="#pricing"><button class="btn-lg btn-outline" style="background:white;color:#111;border:1px solid #ccc;padding:1rem 2rem;border-radius:8px;cursor:pointer;">See Best Prices</button></a>
        </div>
        <div class="specs" style="margin-top:20px;color:#666;font-size:0.9rem;">v1.2.0 ‚Ä¢ Supports A4, A5, Thermal 2" & 3" ‚Ä¢ 200MB ‚Ä¢ No Internet Required</div>
    </section>

    <section id="features" class="features" style="max-width:1200px;margin:30px auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;padding:0 20px;">
        <div class="feature-card"><h3>‚ö° Lightning Fast</h3><p>Generates bills in seconds. Works 100% offline.</p></div>
        <div class="feature-card"><h3>üñ®Ô∏è All Paper Sizes</h3><p>Supports A4, A5, and Thermal Printers.</p></div>
        <div class="feature-card"><h3>üáÆüá≥ For India</h3><p>Pre-loaded with Indian State codes and formats.</p></div>
    </section>

    <section id="pricing" class="pricing-section">
        <h2 class="section-title">Unbeatable Pricing</h2>
        <div class="dist-input-container">
            <p style="margin-bottom:10px; font-weight:600;">Have a Distributor Code?</p>
            <div style="display:flex;gap:10px;justify-content:center;">
                <input type="text" id="distCode" class="dist-input" placeholder="Enter Code (e.g. ZARQEEN10)">
                <button onclick="applyCode()" class="nav-btn" style="cursor:pointer;">Apply</button>
            </div>
            <p id="codeMsg" style="font-size:0.9rem; margin-top:5px; min-height:20px;"></p>
        </div>
        <div class="pricing-grid">
            <div class="plan-card"><div class="plan-name">Trial</div><div class="price">Free</div><p class="plan-desc">7 Days access</p><a href="https://drive.google.com/drive/folders/17O3vY4KYUzd7Rma4o8rp3j2iIrpqhJe9" target="_blank" style="margin-top:auto;"><button class="btn-buy secondary">Download</button></a></div>
            <div class="plan-card"><div class="plan-name">Basic</div><div class="price">‚Çπ299<span>/yr</span></div><p class="plan-desc">Ideal for new customers</p><button class="btn-buy primary" onclick="buyPlan('basic')">Buy Basic</button></div>
            <div class="plan-card popular"><div class="badge">BEST VALUE</div><div class="plan-name">Premium</div><div class="price">‚Çπ599<span>/3yrs</span></div><p class="plan-desc">For smart owners</p><button class="btn-buy primary" onclick="buyPlan('premium')">Buy Premium</button></div>
        </div>
    </section>

    <footer><p>&copy; <span id="year"></span> Zarqeen Accounting.</p><div class="footer-admin"><a onclick="openLoginModal()" style="cursor:pointer;">Admin Login</a></div></footer>

    <!-- DASHBOARD -->
    <div id="dashboardSection">
        <div style="max-width:1200px; margin:0 auto;">
            <div class="dash-header">
                <div><h2 id="dashName">Distributor</h2><p style="color:#666;">Code: <strong id="dashCode"></strong></p></div>
                <button onclick="doLogout()" class="btn-buy secondary" style="width:auto;margin:0;background:#EF4444;color:white;">Logout</button>
            </div>
            <div class="dash-grid">
                <div class="dash-card"><div class="dash-val" id="dashTotal">0</div><div>Total Sold</div></div>
                <div class="dash-card"><div class="dash-val">‚Çπ<span id="dashComm">0.00</span></div><div>Commission</div></div>
                <div class="dash-card"><div class="dash-val"><span id="dashDisc">0</span>%</div><div>Discount</div></div>
            </div>
            <div class="dash-header" style="margin-top:-10px;">
                <h3>My Banking</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; font-size:0.9rem;">
                    <div><p>Bank: <strong id="d_bank"></strong></p><p>Holder: <strong id="d_holder"></strong></p></div>
                    <div><p>Acct: <strong id="d_acct"></strong></p><p>IFSC: <strong id="d_ifsc"></strong></p><p>UPI: <strong id="d_upi"></strong></p></div>
                </div>
            </div>
            <h3 style="margin-bottom:15px; display:flex; justify-content:space-between;">Sales History <span id="pageInfo" style="font-size:0.9rem; color:gray"></span></h3>
            <table class="dash-table">
                <thead><tr><th>Date</th><th>Plan</th><th>Amount</th><th>Status</th><th>Key</th><th>Ver</th><th>Last Active</th><th>Expiry</th><th>Action</th></tr></thead>
                <tbody id="dashTableBody"></tbody>
            </table>
            <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
                <button id="prevBtn" onclick="changePage(-1)" class="nav-btn" style="background:gray; display:none;">Prev</button>
                <button id="nextBtn" onclick="changePage(1)" class="nav-btn" style="background:#2563EB; display:none;">Next</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="licenseModal" class="modal"><div class="modal-content" style="text-align:center;"><div style="font-size:3.5rem;">üéâ</div><h2 style="color:#059669;">Success!</h2><p>Download your license.</p><div id="licenseKeyArea" class="key-box"></div><button class="btn-buy secondary" onclick="closeLicenseModal()">Close</button></div></div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" onclick="closeLoginModal()">&times;</span>
            <h2 style="text-align:center; margin-bottom:20px;">Portal Login</h2>
            <div class="login-tabs">
                <button class="tab-btn active" onclick="switchTab('distributor')">Distributor</button>
                <button class="tab-btn" onclick="switchTab('admin')">Admin</button>
            </div>
            
            <form id="distForm" class="login-form active">
                <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
                <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
                <div style="text-align:right;"><a onclick="showForgot()" style="color:blue; cursor:pointer; font-size:0.8rem;">Forgot Password?</a></div>
                <button type="submit" class="btn-buy primary">Login</button>
            </form>

            <div id="forgotFlow" style="display:none;">
                <div id="step1"><h3>Reset Password</h3><input type="email" id="resetEmail" placeholder="Enter Email" style="width:100%;padding:10px;margin:10px 0;"><button onclick="sendOtp()" class="btn-buy primary">Send OTP</button></div>
                <div id="step2" style="display:none;"><h3>Verify OTP</h3><input type="text" id="otpCode" placeholder="6-digit Code" style="width:100%;padding:10px;margin:10px 0;"><input type="password" id="newPass" placeholder="New Password" style="width:100%;padding:10px;margin:10px 0;"><button onclick="resetWithOtp()" class="btn-buy primary">Change Password</button></div>
                <p style="text-align:center; margin-top:10px;"><a onclick="hideForgot()" style="cursor:pointer; color:gray;">Back</a></p>
            </div>

            <form id="adminForm" class="login-form" method="POST">
                <div class="form-group"><label>Username</label><input type="text" name="username" required></div>
                <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
                <button type="submit" class="btn-buy primary" style="background:#111827;">Login Admin</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        let RAZORPAY_KEY_ID = null;
        const BACKEND_URL = "https://zarqeen-backend.onrender.com";
        document.getElementById('adminForm').action = `${BACKEND_URL}/admin/login`;

        function showLoader(txt) { document.getElementById('actionLoader').style.display='flex'; }
        function hideLoader() { document.getElementById('actionLoader').style.display='none'; }

        async function fetchConfig() {
            try { const res = await fetch(`${BACKEND_URL}/api/get-config`); const data = await res.json(); RAZORPAY_KEY_ID = data.key_id; } catch(e) { console.error(e); }
        }
        fetchConfig();

        function closeLicenseModal() { document.getElementById('licenseModal').style.display='none'; location.reload(); }
        function openLoginModal() { document.getElementById('loginModal').style.display='block'; }
        function closeLoginModal() { document.getElementById('loginModal').style.display='none'; }
        
        function switchTab(type) {
            document.getElementById('forgotFlow').style.display='none';
            const btns = document.querySelectorAll('.tab-btn');
            if(type === 'distributor') {
                document.getElementById('distForm').style.display='block';
                document.getElementById('adminForm').style.display='none';
                btns[0].classList.add('active'); btns[1].classList.remove('active');
            } else {
                document.getElementById('distForm').style.display='none';
                document.getElementById('adminForm').style.display='block';
                btns[0].classList.remove('active'); btns[1].classList.add('active');
            }
        }

        function showForgot() { document.getElementById('distForm').style.display='none'; document.getElementById('forgotFlow').style.display='block'; document.getElementById('step1').style.display='block'; document.getElementById('step2').style.display='none'; }
        function hideForgot() { document.getElementById('forgotFlow').style.display='none'; document.getElementById('distForm').style.display='block'; }

        async function sendOtp() {
            const email = document.getElementById('resetEmail').value;
            if(!email) return alert("Enter email"); showLoader();
            try { const res = await fetch(`${BACKEND_URL}/api/send-otp`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email}) }); const d = await res.json(); hideLoader(); if(d.success) { document.getElementById('step1').style.display='none'; document.getElementById('step2').style.display='block'; alert(d.message); } else alert(d.message); } catch(e) { hideLoader(); alert("Error"); }
        }

        async function resetWithOtp() {
            const email = document.getElementById('resetEmail').value; const otp = document.getElementById('otpCode').value; const pw = document.getElementById('newPass').value;
            if(!otp || !pw) return alert("Fill all fields"); showLoader();
            try { const res = await fetch(`${BACKEND_URL}/api/reset-with-otp`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, otp, new_password:pw}) }); const d = await res.json(); hideLoader(); if(d.success) { alert(d.message); hideForgot(); } else alert(d.message); } catch(e) { hideLoader(); alert("Error"); }
        }

        let ACTIVE_DISTRIBUTOR_CODE = null;
        async function applyCode() {
            const code = document.getElementById('distCode').value.trim(); if(!code) return; showLoader();
            try { const res = await fetch(`${BACKEND_URL}/api/check_distributor`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ code }) }); const data = await res.json(); hideLoader();
            if (data.valid) { ACTIVE_DISTRIBUTOR_CODE = code; document.getElementById('codeMsg').innerText = `‚úÖ ${data.name} applied (${data.discount}% OFF)`; document.getElementById('codeMsg').style.color='green'; } else { ACTIVE_DISTRIBUTOR_CODE = null; document.getElementById('codeMsg').innerText="‚ùå Invalid Code"; document.getElementById('codeMsg').style.color='red'; } } catch(e) { hideLoader(); }
        }

        async function buyPlan(planType) {
            showLoader(); if (!RAZORPAY_KEY_ID) await fetchConfig();
            try {
                const res = await fetch(`${BACKEND_URL}/create_order`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ plan: planType, distributor_code: ACTIVE_DISTRIBUTOR_CODE }) });
                const orderData = await res.json(); hideLoader();
                const options = { "key": RAZORPAY_KEY_ID, "amount": orderData.amount, "currency": "INR", "name": "Zarqeen Alif", "order_id": orderData.id,
                    "handler": async function (response){ showLoader(); try { const verifyRes = await fetch(`${BACKEND_URL}/verify_payment`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ razorpay_payment_id: response.razorpay_payment_id, razorpay_order_id: response.razorpay_order_id, razorpay_signature: response.razorpay_signature, plan_type: planType }) }); const result = await verifyRes.json(); hideLoader();
                    if(result.success) { const blob = new Blob([result.license_key], { type: "text/plain" }); const url = window.URL.createObjectURL(blob); document.getElementById('licenseKeyArea').innerHTML = `<a href="${url}" download="license.zarqeen" class="btn-buy primary" style="text-decoration:none;">‚¨á Download License File</a>`; document.getElementById('licenseModal').style.display='block'; } else alert('Verification failed.'); } catch (e) { hideLoader(); alert("Error"); } } };
                new Razorpay(options).open();
            } catch(e) { hideLoader(); alert("Error connecting to payment gateway"); }
        }

        document.getElementById('distForm').addEventListener('submit', async function(e) { e.preventDefault(); showLoader(); const data = Object.fromEntries(new FormData(this)); try { const res = await fetch(`${BACKEND_URL}/api/distributor/login`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) }); const r = await res.json(); hideLoader(); if(r.success) { localStorage.setItem('dist_token', r.token); closeLoginModal(); loadDashboard(1); } else alert(r.message); } catch(e) { hideLoader(); alert("Error"); } });

        let CURRENT_PAGE = 1;
        async function loadDashboard(page) {
            CURRENT_PAGE = page; const token = localStorage.getItem('dist_token'); if(!token) return; showLoader();
            try { const res = await fetch(`${BACKEND_URL}/api/distributor/data?page=${page}`, { method: 'GET', headers: {'Authorization': `Bearer ${token}`} }); if(res.status === 401) { doLogout(); return; } const data = await res.json();
            document.getElementById('dashName').innerText = data.name; document.getElementById('dashCode').innerText = data.code; document.getElementById('dashTotal').innerText = data.total_sales;
            document.getElementById('dashComm').innerHTML = `<span style="color:#2563EB">Earned: ‚Çπ${Number(data.commission_earned).toFixed(2)}</span><br><span style="color:#059669;font-size:0.8em">Paid: ‚Çπ${Number(data.commission_paid).toFixed(2)}</span><br><span style="color:#DC2626;font-size:0.9em;font-weight:800">Balance: ‚Çπ${Number(data.balance_due).toFixed(2)}</span>`;
            document.getElementById('dashDisc').innerText = data.discount;
            const b = data.bank_info; document.getElementById('d_bank').innerText = b.bank_name||'-'; document.getElementById('d_holder').innerText = b.account_holder||'-'; document.getElementById('d_acct').innerText = b.account_number||'-'; document.getElementById('d_ifsc').innerText = b.ifsc||'-'; document.getElementById('d_upi').innerText = b.upi||'-';
            const tbody = document.getElementById('dashTableBody'); tbody.innerHTML = "";
            data.sales_history.forEach(row => { tbody.innerHTML += `<tr><td>${row.date}</td><td>${row.plan}</td><td>‚Çπ${row.amount}</td><td>${row.status}</td><td style="font-family:monospace">${row.key}</td><td>${row.version||'-'}</td><td>${row.last_login||'-'}</td><td>${row.expiry||'-'}</td><td><a href="${data.backend_url}download/license/${row.key}" class="nav-btn" style="padding:4px 8px;font-size:0.8rem;">‚¨á</a></td></tr>`; });
            const prev = document.getElementById('prevBtn'); const next = document.getElementById('nextBtn');
            document.getElementById('pageInfo').innerText = `Page ${page} of ${data.pagination.total_pages}`;
            prev.style.display = data.pagination.has_prev ? 'inline-block' : 'none'; next.style.display = data.pagination.has_next ? 'inline-block' : 'none';
            document.querySelector('header').style.display='none'; document.querySelector('.hero').style.display='none'; document.getElementById('features').style.display='none'; document.getElementById('pricing').style.display='none'; document.querySelector('footer').style.display='none'; document.getElementById('dashboardSection').style.display='block'; hideLoader(); window.scrollTo(0,0); } catch(e) { hideLoader(); }
        }

        function changePage(dir) { loadDashboard(CURRENT_PAGE + dir); }
        function doLogout() { localStorage.removeItem('dist_token'); location.reload(); }
        window.addEventListener('load', function() { if(localStorage.getItem('dist_token')) loadDashboard(1); });
    </script>
</body>
</html>
